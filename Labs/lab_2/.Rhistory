theme(
plot.title = element_text(face = "bold"),
plot.caption = element_text(size = 9, hjust = 0)
)
# Create distribution visualization
ggplot(vulnerable_tracts_proj)+
aes(x = nearest_hospital_dist) +
geom_histogram(
binwidth = 2,
fill = "orange",
color = "white",
alpha = 0.7
) +
geom_vline(aes(xintercept = 15), color = "blue", linetype = "dashed", size = 1) +
labs(
title = "Distribution of Distances to Nearest Hospital for Vulnerable Tracts",
subtitle = "Dashed line indicates 15-mile threshold for underserved definition",
x = "Distance to Nearest Hospital (miles)",
y = "Number of Vulnerable Tracts",
caption = "Data: ACS 2022 5-year, PA hospitals dataset"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold"),
plot.caption = element_text(size = 9, hjust = 0)
)
# Create distribution visualization
ggplot(vulnerable_tracts_proj)+
aes(x = nearest_hospital_dist) +
geom_histogram(
binwidth = 1,
fill = "orange",
color = "white",
alpha = 0.7
) +
geom_vline(aes(xintercept = 15), color = "blue", linetype = "dashed", size = 1) +
labs(
title = "Distribution of Distances to Nearest Hospital for Vulnerable Tracts",
subtitle = "Dashed line indicates 15-mile threshold for underserved definition",
x = "Distance to Nearest Hospital (miles)",
y = "Number of Vulnerable Tracts",
caption = "Data: ACS 2022 5-year, PA hospitals dataset"
) +
theme_minimal(base_size = 12) +
theme(
plot.title = element_text(face = "bold"),
plot.caption = element_text(size = 9, hjust = 0)
)
# Create distribution visualization
ggplot(vulnerable_tracts_proj)+
aes(x = nearest_hospital_dist) +
geom_histogram(
binwidth = 1,
fill = "orange",
color = "white",
alpha = 0.7
) +
geom_vline(aes(xintercept = 15), color = "blue", linetype = "dashed", size = 1) +
labs(
title = "Distribution of Distances to Nearest Hospital for Vulnerable Tracts",
subtitle = "Dashed line indicates 15-mile underserved threshold",
x = "Distance to Nearest Hospital (miles)",
y = "Number of Vulnerable Tracts",
caption = "Data: ACS 2022 5-year, PA hospitals dataset"
) +
theme_minimal
# Create distribution visualization
ggplot(vulnerable_tracts_proj)+
aes(x = nearest_hospital_dist) +
geom_histogram(
binwidth = 1,
fill = "orange",
color = "white",
alpha = 0.7
) +
geom_vline(aes(xintercept = 15), color = "blue", linetype = "dashed", size = 1) +
labs(
title = "Distribution of Distances to Nearest Hospital for Vulnerable Tracts",
subtitle = "Dashed line indicates 15-mile underserved threshold",
x = "Distance to Nearest Hospital (miles)",
y = "Number of Vulnerable Tracts",
caption = "Data: ACS 2022 5-year, PA hospitals dataset"
) +
theme_minimal()
# Load your additional dataset
polling <- st_read("data/polling_places.geojson")
bus <- st_read("data/septa_bus.geojson")
metro <- st_read("data/septa_metro.geojson")
rail <- st_read("data/septa_rail.geojson")
trolley <- st_read("data/septa_trolley.geojson")
st_crs(polling)
st_crs(bus)
st_crs(metro)
# Load your additional dataset
polling <- st_read("data/polling_places.geojson")
bus <- st_read("data/septa_bus.geojson")
metro <- st_read("data/septa_metro.geojson")
rail <- st_read("data/septa_rail.geojson")
trolley <- st_read("data/septa_trolley.geojson")
phl_tracts <- tracts(state = "PA", county = "Philadelphia", cb = TRUE)
phl_acs_vars <- c(
total_pop = "B01003_001",
age65_66_m = "B01001_020",
age67_69_m = "B01001_021",
age70_74_m = "B01001_022",
age75_79_m = "B01001_023",
age80_84_m = "B01001_024",
age85_over_m = "B01001_025",
age65_66_f = "B01001_044",
age67_69_f = "B01001_045",
age70_74_f = "B01001_046",
age75_79_f = "B01001_047",
age80_84_f = "B01001_048",
age85_over_f = "B01001_049",
total_disab = "C18108_001",
disabled_pop = "C18108_002"
)
phl_acs <- get_acs(
geography = "tract",
variables = phl_acs_vars,
state = "PA",
county = "Philadelphia",
year = 2022,
survey = "acs5",
output = "wide"
)
phl_acs <- phl_acs %>%
mutate(
pop65plusE = age65_66_mE + age67_69_mE + age70_74_mE + age75_79_mE +
age80_84_mE + age85_over_mE +
age65_66_fE + age67_69_fE + age70_74_fE + age75_79_fE +
age80_84_fE + age85_over_fE,
pct_elder = 100 * pop65plusE / total_popE,
pct_disabled = 100 * disabled_popE / total_disabE
)
phl_tracts_acs <- phl_tracts %>%
left_join(phl_acs, by = "GEOID")
st_crs(polling)
st_crs(bus)
st_crs(metro)
st_crs(rail)
st_crs(trolley)
st_crs(phl_tracts_acs)
septa_stops <- bind_rows(
bus %>% mutate(mode = "Bus"),
metro %>% mutate(mode = "Metro"),
rail %>% mutate(mode = "Regional Rail"),
trolley %>% mutate(mode = "Trolley")
)
polling <- st_transform(polling, 3365)
septa_stops <- st_transform(septa_stops, 3365)
phl_tracts_acs <- st_transform(phl_tracts_acs, 3365)
View(vul_counties)
View(septa_stops)
nrow(polling)
nrow(septa_stops)
nrow(phl_tracts_acs)
# Load your additional dataset
polling <- st_read("data/polling_places.geojson")
bus <- st_read("data/septa_bus.geojson")
metro <- st_read("data/septa_metro.geojson")
rail <- st_read("data/septa_rail.geojson")
trolley <- st_read("data/septa_trolley.geojson")
phl_tracts <- tracts(state = "PA", county = "Philadelphia", cb = TRUE)
phl_acs_vars <- c(
total_pop = "B01003_001",
age65_66_m = "B01001_020",
age67_69_m = "B01001_021",
age70_74_m = "B01001_022",
age75_79_m = "B01001_023",
age80_84_m = "B01001_024",
age85_over_m = "B01001_025",
age65_66_f = "B01001_044",
age67_69_f = "B01001_045",
age70_74_f = "B01001_046",
age75_79_f = "B01001_047",
age80_84_f = "B01001_048",
age85_over_f = "B01001_049",
total_disab = "C18108_001",
disabled_pop = "C18108_002"
)
phl_acs <- get_acs(
geography = "tract",
variables = phl_acs_vars,
state = "PA",
county = "Philadelphia",
year = 2022,
survey = "acs5",
output = "wide"
)
phl_acs <- phl_acs %>%
mutate(
pop65plusE = age65_66_mE + age67_69_mE + age70_74_mE + age75_79_mE +
age80_84_mE + age85_over_mE +
age65_66_fE + age67_69_fE + age70_74_fE + age75_79_fE +
age80_84_fE + age85_over_fE,
pct_elderly = 100 * pop65plusE / total_popE,
pct_disabled = 100 * disabled_popE / total_disabE
)
phl_tracts_acs <- phl_tracts %>%
left_join(phl_acs, by = "GEOID")
st_crs(polling)
st_crs(bus)
st_crs(metro)
st_crs(rail)
st_crs(trolley)
st_crs(phl_tracts_acs)
septa_stops <- bind_rows(
bus %>% mutate(mode = "Bus"),
metro %>% mutate(mode = "Metro"),
rail %>% mutate(mode = "Regional Rail"),
trolley %>% mutate(mode = "Trolley")
)
polling <- st_transform(polling, 3365)
septa_stops <- st_transform(septa_stops, 3365)
phl_tracts_acs <- st_transform(phl_tracts_acs, 3365)
nrow(polling)
nrow(septa_stops)
nrow(phl_tracts_acs)
# Your spatial analysis
polling_buf <- st_buffer(polling, dist = 1320)
stops_buf <- st_buffer(septa_stops, dist = 1320)
accessible_area <- st_intersection(polling_buf, stops_buf)
phl_tract_access <- phl_tracts_acs %>%
st_join(accessible_area, join = st_intersects) %>%
mutate(accessible = !is.na(st_area))
phl_tract_summary <- phl_tract_access %>%
group_by(accessible) %>%
summarise(
total_pop = sum(total_popE, na.rm = TRUE),
elderly_pop = sum(pop65plusE, na.rm = TRUE),
disabled_pop = sum(disabled_popE, na.rm = TRUE)
)
View(phl_tract_summary)
View(phl_tract_access)
ggplot() +
geom_sf(data = phl_tracts_acs, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = polling, color = "red", size = 0.5) +
theme_void()
ggplot() +
geom_sf(data = phl_tracts_acs, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = polling, color = "red", size = 0.1) +
theme_void()
ggplot() +
geom_sf(data = phl_tracts_acs, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = polling, color = "red", size = 0.1) +
geom_sf(data = accessible_area, fill = "yellow", color = "grey", size = 0.5) +
theme_void()
# Your spatial analysis
polling_buf <- st_buffer(polling, dist = 1320)
stops_buf <- st_buffer(septa_stops, dist = 1320)
accessible_area <- st_intersection(polling_buf, stops_buf)
phl_tract_access <- phl_tracts_acs %>%
st_join(accessible_area, join = st_intersects) %>%
mutate(accessible = !is.na(st_area))
phl_tract_summary <- phl_tract_access %>%
group_by(accessible) %>%
summarise(
total_pop = sum(total_popE, na.rm = TRUE),
elderly_pop = sum(pop65plusE, na.rm = TRUE),
disabled_pop = sum(disabled_popE, na.rm = TRUE)
)
ggplot() +
geom_sf(data = phl_tracts_acs, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = polling, color = "red", size = 0.1) +
theme_void()
ggplot() +
geom_sf(data = phl_tract_access, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = inaccessible_tracts, fill = "red", color = "grey", size = 0.5) +
theme_void()
inaccessible_tracts <- phl_tract_access %>%
filter(accessible == FALSE)
ggplot() +
geom_sf(data = phl_tract_access, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = inaccessible_tracts, fill = "red", color = "grey", size = 0.5) +
theme_void()
View(phl_tract_summary)
ggplot() +
geom_sf(data = phl_tracts_acs, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = polling, color = "red", size = 0.1) +
theme_void()
# Your spatial analysis
polling_buf <- st_buffer(polling, dist = 600)
stops_buf <- st_buffer(septa_stops, dist = 600)
accessible_area <- st_intersection(polling_buf, stops_buf)
phl_tract_access <- phl_tracts_acs %>%
st_join(accessible_area, join = st_intersects) %>%
mutate(accessible = !is.na(st_area))
phl_tract_summary <- phl_tract_access %>%
group_by(accessible) %>%
summarise(
total_pop = sum(total_popE, na.rm = TRUE),
elderly_pop = sum(pop65plusE, na.rm = TRUE),
disabled_pop = sum(disabled_popE, na.rm = TRUE)
)
ggplot() +
geom_sf(data = phl_tracts_acs, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = polling, color = "red", size = 0.1) +
theme_void()
inaccessible_tracts <- phl_tract_access %>%
filter(accessible == FALSE)
ggplot() +
geom_sf(data = phl_tract_access, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = inaccessible_tracts, fill = "red", color = "grey", size = 0.5) +
theme_void()
ggplot() +
geom_sf(data = phl_tracts_acs, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = polling, color = "red", size = 0.1) +
geom_sf(data = septa_stops, color = "yellow", size = 0.1) +
theme_void()
ggplot() +
+   geom_sf(data = phl_tracts_acs, fill = "white", color = "grey", size = 0.5) +
+   geom_sf(data = polling, color = "red", size = 0.1) +
+   geom_sf(data = septa_stops, color = "yellow", size = 0.1) +
+   theme_void()
# Your spatial analysis
polling_buf <- st_buffer(polling, dist = 500)
stops_buf <- st_buffer(septa_stops, dist = 500)
accessible_area <- st_intersection(polling_buf, stops_buf)
phl_tract_access <- phl_tracts_acs %>%
st_join(accessible_area, join = st_intersects) %>%
mutate(accessible = !is.na(st_area))
phl_tract_summary <- phl_tract_access %>%
group_by(accessible) %>%
summarise(
total_pop = sum(total_popE, na.rm = TRUE),
elderly_pop = sum(pop65plusE, na.rm = TRUE),
disabled_pop = sum(disabled_popE, na.rm = TRUE)
)
ggplot() +
geom_sf(data = phl_tracts_acs, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = polling, color = "red", size = 0.1) +
geom_sf(data = septa_stops, color = "yellow", size = 0.1) +
theme_void()
inaccessible_tracts <- phl_tract_access %>%
filter(accessible == FALSE)
ggplot() +
geom_sf(data = phl_tract_access, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = inaccessible_tracts, fill = "red", color = "grey", size = 0.5) +
theme_void()
# Your spatial analysis
polling_buf <- st_buffer(polling, dist = 500)
stops_buf <- st_buffer(septa_stops, dist = 500)
accessible_area <- st_intersection(polling_buf, stops_buf)
phl_tract_access <- phl_tracts_acs %>%
st_join(accessible_area, join = st_intersects) %>%
mutate(accessible = !is.na(st_area))
phl_tract_summary <- phl_tract_access %>%
group_by(accessible) %>%
summarise(
total_pop = sum(total_popE, na.rm = TRUE),
elderly_pop = sum(pop65plusE, na.rm = TRUE),
disabled_pop = sum(disabled_popE, na.rm = TRUE)
)
ggplot() +
geom_sf(data = phl_tracts_acs, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = polling, color = "red", size = 0.1) +
theme_void()
inaccessible_tracts <- phl_tract_access %>%
filter(accessible == FALSE)
ggplot() +
geom_sf(data = phl_tract_access, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = inaccessible_tracts, fill = "red", color = "grey", size = 0.5) +
theme_void()
accessible_area_union <- accessible_area %>%
st_union() %>%          # 合并为一个多边形集合
st_make_valid() %>%     # 修复可能的几何错误（很常见）
st_sf()                 # 转回 sf 对象以便后续绘图或 join
ggplot() +
geom_sf(data = phl_tract_access, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = inaccessible_tracts, fill = "red", color = "grey", size = 0.5) +
geom_sf(data = accessible_area_union, fill = "yellow", color = "grey", size = 0.5) +
theme_void()
View(accessible_area_union)
phl_tract_access <- phl_tracts_acs %>%
st_join(accessible_area_union, join = st_intersects) %>%
mutate(accessible = !is.na(st_area))
View(phl_tract_access)
phl_tract_access <- phl_tracts_acs %>%
st_join(accessible_area_union, join = st_intersects, left = TRUE) %>%
mutate(accessible = !st_is_empty(geometry.y))
phl_tract_access <- phl_tracts_acs %>%
st_join(accessible_area_union, join = st_intersects, left = TRUE)
phl_tract_access$accessible <- !is.na(phl_tract_access$GEOID.y)
View(phl_tract_access)
ggplot() +
geom_sf(data = phl_tract_access, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = inaccessible_tracts, fill = "red", color = "grey", size = 0.5) +
geom_sf(data = accessible_area_union, fill = "yellow", color = "grey", size = 0.5) +
theme_void()
hit <- st_intersects(tracts_3365, accessible_area_union, sparse = FALSE)[,1]
hit <- st_intersects(phl_tracts_acs, accessible_area_union, sparse = FALSE)[,1]
phl_tract_access <- phl_tracts_acs |>
mutate(accessible = hit)
# 不可达 tracts
inaccessible_tracts <- phl_tract_access |> filter(!accessible)
n_inacc <- nrow(inaccessible_tracts)   # 应该 > 0
View(inaccessible_tracts)
ggplot() +
geom_sf(data = phl_tract_access, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = inaccessible_tracts, fill = "red", color = "grey", size = 0.5) +
geom_sf(data = accessible_area_union, fill = "yellow", color = "grey", size = 0.5) +
theme_void()
View(phl_tract_access)
hit <- st_intersects(phl_tracts_acs, accessible_area_union, sparse = FALSE)[,1]
phl_tract_access <- phl_tracts_acs %>%
mutate(accessible = hit)
# Your spatial analysis
polling_buf <- st_buffer(polling, dist = 500)
stops_buf <- st_buffer(septa_stops, dist = 500)
accessible_area <- st_intersection(polling_buf, stops_buf)
accessible_area_union <- accessible_area %>%
st_union() %>%
st_make_valid() %>%
st_sf()
hit <- st_intersects(phl_tracts_acs, accessible_area_union, sparse = FALSE)[,1]
phl_tract_access <- phl_tracts_acs %>%
mutate(accessible = hit)
phl_tract_summary <- phl_tract_access %>%
group_by(accessible) %>%
summarise(
total_pop = sum(total_popE, na.rm = TRUE),
elderly_pop = sum(pop65plusE, na.rm = TRUE),
disabled_pop = sum(disabled_popE, na.rm = TRUE)
)
ggplot() +
geom_sf(data = phl_tracts_acs, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = polling, color = "red", size = 0.1) +
theme_void()
inaccessible_tracts <- phl_tract_access %>%
filter(accessible == FALSE)
ggplot() +
geom_sf(data = phl_tract_access, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = inaccessible_tracts, fill = "red", color = "grey", size = 0.5) +
geom_sf(data = accessible_area_union, fill = "yellow", color = "grey", size = 0.5) +
theme_void()
# Your spatial analysis
polling_buf <- st_buffer(polling, dist = 1320)
stops_buf <- st_buffer(septa_stops, dist = 1320)
accessible_area <- st_intersection(polling_buf, stops_buf)
accessible_area_union <- accessible_area %>%
st_union() %>%
st_make_valid() %>%
st_sf()
hit <- st_intersects(phl_tracts_acs, accessible_area_union, sparse = FALSE)[,1]
phl_tract_access <- phl_tracts_acs %>%
mutate(accessible = hit)
phl_tract_summary <- phl_tract_access %>%
group_by(accessible) %>%
summarise(
total_pop = sum(total_popE, na.rm = TRUE),
elderly_pop = sum(pop65plusE, na.rm = TRUE),
disabled_pop = sum(disabled_popE, na.rm = TRUE)
)
ggplot() +
geom_sf(data = phl_tracts_acs, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = polling, color = "red", size = 0.1) +
theme_void()
inaccessible_tracts <- phl_tract_access %>%
filter(accessible == FALSE)
ggplot() +
geom_sf(data = phl_tract_access, fill = "white", color = "grey", size = 0.5) +
geom_sf(data = inaccessible_tracts, fill = "red", color = "grey", size = 0.5) +
geom_sf(data = accessible_area_union, fill = "yellow", color = "grey", size = 0.5) +
theme_void()
phl_tract_summary <- phl_tract_access %>%
st_drop_geometry() %>%
group_by(accessible) %>%
summarise(
total_pop = sum(total_popE, na.rm = TRUE),
elderly_pop = sum(pop65plusE, na.rm = TRUE),
disabled_pop = sum(disabled_popE, na.rm = TRUE)
)
View(phl_tract_summary)
View(phl_tract_summary)
# Load required packages
library(sf)
library(ggplot2)
library(knitr)
library(tidyverse)
library(tidycensus)
library(tigris)
census_api_key("a429b978d14aa85d33761ac9dead46b91ad63915")
# Load spatial data
pa_counties <- counties(state = "PA", cb = TRUE)
pa_tracts <- tracts(state = "PA", cb = TRUE)
hospitals <- st_read("data/hospitals.geojson")
# Load required packages
library(sf)
library(ggplot2)
library(knitr)
library(tidyverse)
library(tidycensus)
library(tigris)
census_api_key("a429b978d14aa85d33761ac9dead46b91ad63915")
# Load spatial data
pa_counties <- counties(state = "PA", cb = TRUE)
pa_tracts <- tracts(state = "PA", cb = TRUE)
hospitals <- st_read("data/hospitals.geojson")
# Load required packages
library(sf)
library(ggplot2)
library(knitr)
library(tidyverse)
library(tidycensus)
library(tigris)
census_api_key("a429b978d14aa85d33761ac9dead46b91ad63915")
# Load spatial data
pa_counties <- counties(state = "PA", cb = TRUE)
pa_tracts <- tracts(state = "PA", cb = TRUE)
hospitals <- st_read("data/hospitals.geojson")
getwd()
